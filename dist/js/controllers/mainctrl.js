module.exports=function(e,t){if(e.brokerInitialized=!1,e.alertMessage=null,e.fraudScoreResults=[],e.poolSize=1,e.taskCount=1,e.runtimeStats={requestedPoolSize:1,allocatedPoolSize:1,submittedTasks:0,successfulTasks:0,failedTasks:0,averageCodeExecution:0,averageServerOverhead:0,averageNetworkLatency:0},e.targetTaskThroughput=0,e.currentTaskThroughput=0,e.startTaskThroughput=0,e.secondTaskThroughput=0,e.minuteTaskThroughput=0,!e.socketInitialized){var o=Primus.connect("ws://localhost:3000");o.on("open",function(){o.on("/topic/fraud",function(t){var o=t;if("FRAUDSCORE"==o.msgType){var s=Date.now()-e.startTaskThroughput;e.$apply(function(){e.currentTaskThroughput+=1;var t=1e3/s*e.currentTaskThroughput;e.secondTaskThroughput=t-t%.01,e.minuteTaskThroughput=Math.round(60*e.secondTaskThroughput),e.fraudScoreResults.length>300&&(e.fraudScoreResults.length=150),e.fraudScoreResults.unshift(o)})}else"RUNTIMESTATS"==o.msgType?e.$apply(function(){e.alertMessage=null,e.runtimeStats=o}):"CLIENTALERT"==o.msgType&&e.$apply(function(){e.alertMessage=o.msg})})}),e.socketInitialized=!0}e.resizePool=function(){e.alertMessage="RBroker pool is initializing. Requested "+e.poolSize+" R session(s) in the pool. This may take some time. Please wait.",e.brokerInitialized=!1,console.log("Attempt to resize pool succeeded, new size="+e.poolSize),t.post("/fraud/pool/init/"+e.poolSize).success(function(){e.alertMessage=null,console.log("Attempt to resize pool succeeded, new size="+e.poolSize)}).error(function(t){e.errorMessage="Attempt to resize pool failed, error="+t}).finally(function(){e.fraudScoreResults=[],e.brokerInitialized=!0,e.currentTaskThroughput=0,e.secondTaskThroughput=0,e.minuteTaskThroughput=0})},e.executeTasks=function(){e.currentTaskThroughput=0,e.secondTaskThroughput=0,e.minuteTaskThroughput=0,e.targetTaskThroughput=e.taskCount,e.startTaskThroughput=Date.now(),t.get("/fraud/score/"+e.taskCount).success(function(){console.log("Attempt to execute tasks succeeded, taskCount="+e.taskCount)}).error(function(t){e.errorMessage="Can't retrieve scores list!",e.errorMessage="Attempt to execute tasks failed, error="+t})},e.resizePool()};